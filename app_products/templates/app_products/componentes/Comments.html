<!-- ================= COMENTARIOS ================= -->
<div class="mt-5">

    <h3 class="fw-bold mb-4">Comentarios</h3>

    <!-- PROMEDIO -->
    <div class="mb-4">
        <span class="text-warning fs-5">
            {% for i in "12345" %}
                {% if forloop.counter <= avg_rating %}
                    â˜…
                {% else %}
                    â˜†
                {% endif %}
            {% endfor %}
        </span>
        <small class="text-muted">
            ({{ comments|length }} reseÃ±as Â· Promedio {{ avg_rating }})
        </small>
    </div>

    <!-- LISTA DE COMENTARIOS -->
    <div id="commentsContainer">
        {% if comments %}
            {% for comentario in comments|slice:":5" %}
                <div class="comment-item card mb-3 shadow-sm">
                    <div class="card-body">

                        <div class="d-flex justify-content-between mb-2">
                            <div>
                                <h6 class="fw-bold mb-0">
                                    {{ comentario.name|truncatechars:30 }}
                                </h6>

                                <div class="text-warning">
                                    {% for i in "12345" %}
                                        {% if forloop.counter <= comentario.rating %}
                                            â˜…
                                        {% else %}
                                            â˜†
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>

                            <small class="text-muted">
                                {{ comentario.created_at|date:"d M Y" }}
                            </small>
                        </div>

                        <p class="mb-0">
                            {{ comentario.comment|truncatechars:300 }}
                        </p>

                    </div>
                </div>
            {% endfor %}

            <!-- Comentarios ocultos (para cargar con JavaScript) -->
            <div id="hiddenComments" style="display: none;">
                {% for comentario in comments|slice:"5:" %}
                    <div class="comment-item card mb-3 shadow-sm" data-index="{{ forloop.counter0 }}">
                        <div class="card-body">

                            <div class="d-flex justify-content-between mb-2">
                                <div>
                                    <h6 class="fw-bold mb-0">
                                        {{ comentario.name|truncatechars:30 }}
                                    </h6>

                                    <div class="text-warning">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= comentario.rating %}
                                                â˜…
                                            {% else %}
                                                â˜†
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>

                                <small class="text-muted">
                                    {{ comentario.created_at|date:"d M Y" }}
                                </small>
                            </div>

                            <p class="mb-0">
                                {{ comentario.comment|truncatechars:300 }}
                            </p>

                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- BotÃ³n Ver mÃ¡s -->
            {% if comments|length > 5 %}
                <div class="text-center mt-4 mb-3">
                    <button id="loadMoreBtn" class="btn btn-outline-primary" onclick="loadMoreComments()">
                        Ver mÃ¡s comentarios
                    </button>
                </div>
            {% endif %}

        {% else %}
            <p class="text-muted text-center">
                AÃºn no hay comentarios. SÃ© el primero ðŸ˜Š
            </p>
        {% endif %}
    </div>

</div>

<!-- ================= FORMULARIO ================= -->
<div class="mb-4 ">
    <div class="p-4">

        <h5 class="fw-bold mb-3">Deja tu comentario</h5>

        <form method="POST">
            {% csrf_token %}

            <div class="mb-3">
                <label class="form-label fw-semibold">Nombre</label>
                <input
                    type="text"
                    name="name"
                    class="form-control"
                    maxlength="30"
                    required
                >
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">CalificaciÃ³n</label>

                <div id="star-rating" class="fs-3 text-warning" style="cursor:pointer;">
                    <span data-value="1">â˜†</span>
                    <span data-value="2">â˜†</span>
                    <span data-value="3">â˜†</span>
                    <span data-value="4">â˜†</span>
                    <span data-value="5">â˜†</span>
                </div>

                <input type="hidden" name="rating" id="rating-value" required>
            </div>

            <div class="mb-3">
                <label class="form-label fw-semibold">Comentario</label>
                <textarea
                    name="comment"
                    class="form-control"
                    rows="4"
                    maxlength="300"
                    required
                ></textarea>
            </div>

            <button type="submit" class="btn btn-dark fw-bold">
                Publicar comentario
            </button>
        </form>

    </div>
</div>